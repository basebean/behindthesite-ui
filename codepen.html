
<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">

  <meta name="robots" content="noindex">

  <title>Playground fork - CodePen</title>

   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, x-minimal-ui"/>

  <link rel='stylesheet prefetch' href='http://fonts.googleapis.com/css?family=Signika'>
<link rel='stylesheet prefetch' href='http://netdna.bootstrapcdn.com/bootswatch/latest/slate/bootstrap.min.css'>
<link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css'>

  <style>/*

i.fa.fa-external-link
i.fa.fa-file
span.glyphicon.glyphicon-file
span.glyphicon.glyphicon-resize-full
span.glyphicon.glyphicon-comment
i.fa.fa-expand
i.fa.fa-bars

http://fonts.googleapis.com/css?family=Signika

//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css

//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css

//netdna.bootstrapcdn.com/bootswatch/latest/slate/bootstrap.min.css

https://github.com/thomaspark/bootswatch/tree/gh-pages/slate

http://netdna.bootstrapcdn.com/bootswatch/latest/slate/bootstrap.min.css
*/
@-moz-document url-prefix() {
  fieldset {
    display: table-cell;
  }
}
.pad {
  padding-top: 100px;
  padding-bottom: 100px;
}
.title {
  font-family: 'Signika', sans-serif;
  font-style: italic;
  color: #fff;
}
.cursor {
  cursor: pointer;
  cursor: hand;
}
.close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
}
.affix {
  top: 0px;
  z-index: 99999;
  color: #c8c8c8;
  background: #272b30;
  border-color: gray;
}
/*! 
 * angular-loading-bar v0.6.0
 * https://chieffancypants.github.io/angular-loading-bar
 * Copyright (c) 2014 Wes Cruver
 * License: MIT
 */
/* Make clicks pass-through */
#loading-bar,
#loading-bar-spinner {
  pointer-events: none;
  -webkit-pointer-events: none;
  -webkit-transition: 350ms linear all;
  -moz-transition: 350ms linear all;
  -o-transition: 350ms linear all;
  transition: 350ms linear all;
}
#loading-bar.ng-enter,
#loading-bar.ng-leave.ng-leave-active,
#loading-bar-spinner.ng-enter,
#loading-bar-spinner.ng-leave.ng-leave-active {
  opacity: 0;
}
#loading-bar.ng-enter.ng-enter-active,
#loading-bar.ng-leave,
#loading-bar-spinner.ng-enter.ng-enter-active,
#loading-bar-spinner.ng-leave {
  opacity: 1;
}
#loading-bar .bar {
  -webkit-transition: width 350ms;
  -moz-transition: width 350ms;
  -o-transition: width 350ms;
  transition: width 350ms;
  background: #2299dd;
  position: fixed;
  z-index: 10002;
  top: 0;
  left: 0;
  width: 100%;
  height: 2px;
  border-bottom-right-radius: 1px;
  border-top-right-radius: 1px;
}
/* Fancy blur effect */
#loading-bar .peg {
  position: absolute;
  width: 70px;
  right: 0;
  top: 0;
  height: 2px;
  opacity: .45;
  -moz-box-shadow: #2299dd 1px 0 6px 1px;
  -ms-box-shadow: #2299dd 1px 0 6px 1px;
  -webkit-box-shadow: #2299dd 1px 0 6px 1px;
  box-shadow: #2299dd 1px 0 6px 1px;
  -moz-border-radius: 100%;
  -webkit-border-radius: 100%;
  border-radius: 100%;
}
#loading-bar-spinner {
  display: block;
  position: fixed;
  z-index: 10002;
  top: 10px;
  left: 10px;
}
#loading-bar-spinner .spinner-icon {
  width: 14px;
  height: 14px;
  border: solid 2px transparent;
  border-top-color: #ffffff;
  border-left-color: #ffffff;
  border-radius: 10px;
  -webkit-animation: loading-bar-spinner 400ms linear infinite;
  -moz-animation: loading-bar-spinner 400ms linear infinite;
  -ms-animation: loading-bar-spinner 400ms linear infinite;
  -o-animation: loading-bar-spinner 400ms linear infinite;
  animation: loading-bar-spinner 400ms linear infinite;
}
@-webkit-keyframes loading-bar-spinner {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-moz-keyframes loading-bar-spinner {
  0% {
    -moz-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -moz-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-o-keyframes loading-bar-spinner {
  0% {
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-ms-keyframes loading-bar-spinner {
  0% {
    -ms-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -ms-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@keyframes loading-bar-spinner {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}</style>

</head>

<body>

<div ng-app="btsApp" class="container-fluid">
  <div class="row">
    <div class="jumbotron">
      <div class="row pad">
        <h2 class="title text-center">BehindTheSite</h2>
        <p class="text-center text-muted"><small>An index of web technology stacks used by a variety of companies and products. </small></p>
      </div>
    </div>
  </div>
  <div class="row container-fluid">
    <script type="text/ng-template" id="productHoverTmpl.html">
      <div class="popover" role="tooltip">
        <div class="arrow"></div>
        <span class="close-btn cursor glyphicon glyphicon-remove"></span>
        <h1 class="popover-title"></h1>
        <div class="popover-content"></div>
      </div>
    </script>
    <script type="text/ng-template" id="productHoverContentTmpl.html">
      <div>
        <p><em><small>{{ categorypath }}</small></em></p>
        <p>{{ description }}</p>
        <p class="well well-sm" ng-show='notes != ""'><strong>"</strong>{{ notes }}<strong>"</strong></p>
        <p>
          <span ng-show='website != ""'><a href="{{ website }}" target="_blank">Website</a> </span>
          <span ng-show='twitter != ""'><a href="{{ twitter }}" target="_blank">Twitter</a> </span>
          <span ng-show='irc != ""'><a href="{{ irc }}" target="_blank">Irc</a> </span>
          <span ng-show='repo != ""'><a href="{{ repo }}" target="_blank">Source-code</a> </span>
          <span ng-show='issues != ""'><a href="{{ issues }}" target="_blank">Issues</a> </span>
          <span ng-show='docs != ""'><a href="{{ docs }}" target="_blank">Docs</a> </span>
          <span ng-show='blogs != ""'><a href="{{ blogs }}" target="_blank">Blog</a> </span>
        </p> 
        </div>
    </script>
    <div ng-controller="TableCtrl as vm" class="row">
      <div id="main" class="col-xs-12">
        <div class="visible-xs">
          <div id="accordion" class="panel-group"> 
            <div ng-repeat="product in vm.products" class="panel panel-default"> 
              <div class="panel-heading">
                <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#{{ product.name | ws }}">{{ product.name }}</a></h4>
              </div>
              <div id="{{ product.name | ws }}" class="panel-collapse collapse">
                <div class="panel-body">
                  <div ng-repeat="tier in product.tiers">
                    <h4>{{ tier.name }}</h4>
                    <ul class="list-unstyled">
                      <li ng-repeat="ea in tier" data-description="{{ ea.product.description }}" data-title="{{ ea.product.name }}" data-website="{{ ea.product.website }}" data-twitter="{{ eaproduct.twitter }}" data-irc="{{ ea.product.irc }}" data-blogs="{{ ea.product.blogs }}" data-repo="{{ ea.product.repo }}" data-issues="{{ ea.product.issues }}" data-docs="{{ ea.product.docs }}" data-category="{{ ea.category.name }}" data-categorypath="{{ ea.category.full_path }}" data-notes="{{ ea.notes }}"><a href="{{ ea.product.website }}" target="_blank" class="btn btn-sm btn-primary">{{ ea.product.name }} </a><small>&nbsp;- {{ ea.category.full_path }} </small></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="hidden-xs">
          <table class="table table-striped table-bordered table-condensed small">
            <thead affix="affix"> 
              <tr>
                <th>Products</th>
                <th ng-repeat="h in vm.headers">{{ h.name }}</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="product in vm.products">
                <td>{{ product.name }}</td>
                <td ng-repeat="tier in product.tiers">
                  <ul class="list-unstyled">
                    <li ng-repeat="ea in tier" data-description="{{ ea.product.description }}" data-title="{{ ea.product.name }}" data-website="{{ ea.product.website }}" data-twitter="{{ eaproduct.twitter }}" data-irc="{{ ea.product.irc }}" data-blogs="{{ ea.product.blogs }}" data-repo="{{ ea.product.repo }}" data-issues="{{ ea.product.issues }}" data-docs="{{ ea.product.docs }}" data-category="{{ ea.category.name }}" data-categorypath="{{ ea.category.full_path }}" data-notes="{{ ea.notes }}" item-displayed="item-displayed"><span class="cursor">{{ ea.product.name }} </span></li>
                  </ul>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js'></script><script src='http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js'></script><script src='http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.20/angular.min.js'></script><script src='http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.20/angular-resource.min.js'></script><script src='http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.20/angular-route.min.js'></script><script src='http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.20/angular-animate.min.js'></script>

  <script>
    /*

http://api.jquery.com/
https://docs.angularjs.org/api/ng/function/angular.element
http://jsfiddle.net/hajpoj/JJQS9/15/
https://thinkster.io/angulartutorial/a-better-way-to-learn-angularjs/
https://docs.angularjs.org/

*/

//*****************************************************************************
// App

var btsApp = angular.module('btsApp', ['btsControllers', 'btsDirectives', 'btsFilters', 'btsServices','chieffancypants.loadingBar', 'ngAnimate']);

btsApp.config(['cfpLoadingBarProvider', function(cfpLoadingBarProvider) {
    cfpLoadingBarProvider.includeSpinner = true; 
    cfpLoadingBarProvider.includeBar = true;
  }])

//*****************************************************************************
// Services
// https://docs.angularjs.org/api/ngResource/service/$resource

var btsServices = angular.module('btsServices', ['ngResource']);

btsServices.factory('TaxonomySvc', ['$resource',
  function($resource){
    return $resource('http://api.behindthesite.com/v1/taxonomy/');
  }]);

btsServices.factory('StackSvc', ['$resource',
  function($resource){
    return $resource('http://api.behindthesite.com/v1/stacks/');
  }]);

//*****************************************************************************
// Directives
// https://docs.angularjs.org/guide/directive

var btsDirectives = angular.module('btsDirectives', []);

btsDirectives.directive('affix', function($templateCache) {
  console.log('affix')
    return function(scope, element, attrs) {
      var ele = angular.element(element);

      scope.affix_widths = [];

      ele.affix({
        offset: {
          top: function() { 
            return  $('#main').offset().top;
          }
        }
      })

      ele.on('affix.bs.affix', function (e) {
        console.log('affix.prior');

        var ths = ele.find('th');
        ths.each(function(i) { 
          scope.affix_widths[i] = $(this).width();
        })

      });

      ele.on('affixed.bs.affix', function (e) {
        console.log('affix.post');
        var ths = ele.find('th');
        ths.each(function(i) {
          $(this).width(scope.affix_widths[i]);
          //console.log(scope.affix_widths[i])
        })
      });

    };
  });

btsDirectives.directive('itemDisplayed', function($templateCache, $compile) {
  console.log('itemDisplayed')
    return function(scope, element, attrs) {
//    console.log(attrs);
      var ele = angular.element(element);
      var span = ele.find('span');

      var tmpl = $templateCache.get('productHoverTmpl.html')
      scope.website = attrs.website;
      scope.twitter = attrs.twitter;
      scope.irc = attrs.irc;
      scope.blogs = attrs.blogs;
      scope.description = attrs.description;
      scope.repo = attrs.repo;
      scope.issues = attrs.issues;
      scope.docs = attrs.docs;
      scope.category = attrs.category;
      scope.categorypath = attrs.categorypath;
      scope.notes = attrs.notes;
      // https://docs.angularjs.org/api/ng/service/$compile
      var contentHtml = $compile($templateCache.get('productHoverContentTmpl.html'))(scope);

      var popupConfig = {
        html: true,
        title: attrs.title,
        content: contentHtml,
        placement: 'top',
        template: tmpl,
        trigger: 'manual'
      };

      span.data('state', 'hover');
      span.popover(popupConfig);
      span.on('mouseenter', function (e) { 
        if (span.data('state') === 'hover') {
          span.popover('show');
        }
      });
      span.on('mouseleave', function (e) { 
        if (span.data('state') === 'hover') {
          span.popover('hide');
        }
      });
      span.on('click', function (e) { 
        if (span.data('state') === 'hover') {
            span.data('state', 'pinned');
        } else {
            span.data('state', 'hover');
            span.popover('hide');
        }
      });

      ele.on('shown.bs.popover', function () {
        ele.find('.close-btn').click( function () {
          span.data('state', 'hover');
          span.popover('hide');
        });        
      });

    };
  });

//*****************************************************************************
// filters
// https://docs.angularjs.org/guide/filter

var btsFilters = angular.module('btsFilters', []);

btsFilters.filter('ws', function () {
    return function (input) {
      if (input) {
        return input.toLowerCase().replace(/[^a-z_]/g, '_');
      }
    };
  });

btsFilters.filter('nocraigslist', function() {
  return function(input) {
    var output = [];
    if(input) {
      for(var i in input) {
        if(input[i].name != 'Craigslist Website' ) {
          output.push(input[i]);
        }
      }
    }
    return output;
  };
});

//*****************************************************************************
// Controllers
// https://docs.angularjs.org/api/ng/directive/ngController

var btsControllers = angular.module('btsControllers', []);

btsControllers.controller('TableCtrl', TableCtrl);

function TableCtrl($scope, TaxonomySvc, StackSvc) {

  var vm = this;
  vm.headers = [];
  vm.products = [];

  vm.getTaxonomyIds = function (taxonomy) {
    var ids = [];
    ids.push( taxonomy.id );
    for( var i in taxonomy.children ) {
      var c = taxonomy.children[i];
      ids = ids.concat( vm.getTaxonomyIds(c) );
    }
    return ids;
  }

  vm.findHeaderIndex = function (tier) {
    var id = tier.category.id;
//    console.log('Searching for: ' + id + ' ' + typeof(id) );
    for(var i in vm.headers) {
//      console.log('In: ' + vm.headers[i].ids);
      var index = $.inArray(id, vm.headers[i].ids);
      if(index > -1) {
        return i;
      }
    }
    return -1;
  }

  TaxonomySvc.get(function(res) {
      var taxonomy = res.taxonomy;
      console.log('Taxonomy: ' + taxonomy.length  );
      for(var index in taxonomy) {
        var t = taxonomy[index];
        var h = { name: t.name }
        h.ids = vm.getTaxonomyIds( t );
//        console.log( h.name + ', ' + h.ids);
        vm.headers.push( h )
      }

      StackSvc.get(function(res) {
          var products = res.products;
          console.log('Products: ' + products.length  );
          for(var index in products) {
            var product = products[index];
            var model = { name: product.name };
            model.company = product.company;
            model.tiers = [];
            for(var header in vm.headers) {
              model.tiers[header] = [];
              model.tiers[header].name = vm.headers[header].name;
            }
            var tiers = product.stack.tiers;
            for(var tier in tiers) {
              var index = vm.findHeaderIndex( tiers[tier] )
    //          console.log('index: ' + index);
    //          console.log(tiers[tier].product);
              model.tiers[index].push( tiers[tier] )
            }
    //        console.log( i.name );
    //        console.log( i.tiers );
            vm.products.push( model )
          } 

        // https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$broadcast downward
        // https://docs.angularjs.org/api/ng/type/$rootScope.Scope#emit upward
        //  $scope.$emit('TableCtrl.completed');    
        //  $scope.$broadcast('TableCtrl.completed');
        });

    });

}

/*! 
 * angular-loading-bar v0.6.0
 * https://chieffancypants.github.io/angular-loading-bar
 * Copyright (c) 2014 Wes Cruver
 * License: MIT
 */
/*
 * angular-loading-bar
 *
 * intercepts XHR requests and creates a loading bar.
 * Based on the excellent nprogress work by rstacruz (more info in readme)
 *
 * (c) 2013 Wes Cruver
 * License: MIT
 */

(function() {

'use strict';

// Alias the loading bar for various backwards compatibilities since the project has matured:
angular.module('angular-loading-bar', ['cfp.loadingBarInterceptor']);
angular.module('chieffancypants.loadingBar', ['cfp.loadingBarInterceptor']);

/**
 * loadingBarInterceptor service
 *
 * Registers itself as an Angular interceptor and listens for XHR requests.
 */
angular.module('cfp.loadingBarInterceptor', ['cfp.loadingBar'])
  .config(['$httpProvider', function ($httpProvider) {

    var interceptor = ['$q', '$cacheFactory', '$timeout', '$rootScope', 'cfpLoadingBar', function ($q, $cacheFactory, $timeout, $rootScope, cfpLoadingBar) {

      /**
       * The total number of requests made
       */
      var reqsTotal = 0;

      /**
       * The number of requests completed (either successfully or not)
       */
      var reqsCompleted = 0;

      /**
       * The amount of time spent fetching before showing the loading bar
       */
      var latencyThreshold = cfpLoadingBar.latencyThreshold;

      /**
       * $timeout handle for latencyThreshold
       */
      var startTimeout;

      /**
       * calls cfpLoadingBar.complete() which removes the
       * loading bar from the DOM.
       */
      function setComplete() {
        $timeout.cancel(startTimeout);
        cfpLoadingBar.complete();
        reqsCompleted = 0;
        reqsTotal = 0;
      }

      /**
       * Determine if the response has already been cached
       * @param  {Object}  config the config option from the request
       * @return {Boolean} retrns true if cached, otherwise false
       */
      function isCached(config) {
        var cache;
        var defaultCache = $cacheFactory.get('$http');
        var defaults = $httpProvider.defaults;

        // Choose the proper cache source. Borrowed from angular: $http service
        if ((config.cache || defaults.cache) && config.cache !== false &&
          (config.method === 'GET' || config.method === 'JSONP')) {
            cache = angular.isObject(config.cache) ? config.cache
              : angular.isObject(defaults.cache) ? defaults.cache
              : defaultCache;
        }

        var cached = cache !== undefined ?
          cache.get(config.url) !== undefined : false;

        if (config.cached !== undefined && cached !== config.cached) {
          return config.cached;
        }
        config.cached = cached;
        return cached;
      }

      return {
        'request': function(config) {
          // Check to make sure this request hasn't already been cached and that
          // the requester didn't explicitly ask us to ignore this request:
          if (!config.ignoreLoadingBar && !isCached(config)) {
            $rootScope.$broadcast('cfpLoadingBar:loading', {url: config.url});
            if (reqsTotal === 0) {
              startTimeout = $timeout(function() {
                cfpLoadingBar.start();
              }, latencyThreshold);
            }
            reqsTotal++;
            cfpLoadingBar.set(reqsCompleted / reqsTotal);
          }
          return config;
        },

        'response': function(response) {
          if (!response.config.ignoreLoadingBar && !isCached(response.config)) {
            reqsCompleted++;
            $rootScope.$broadcast('cfpLoadingBar:loaded', {url: response.config.url, result: response});
            if (reqsCompleted >= reqsTotal) {
              setComplete();
            } else {
              cfpLoadingBar.set(reqsCompleted / reqsTotal);
            }
          }
          return response;
        },

        'responseError': function(rejection) {
          if (!rejection.config.ignoreLoadingBar && !isCached(rejection.config)) {
            reqsCompleted++;
            $rootScope.$broadcast('cfpLoadingBar:loaded', {url: rejection.config.url, result: rejection});
            if (reqsCompleted >= reqsTotal) {
              setComplete();
            } else {
              cfpLoadingBar.set(reqsCompleted / reqsTotal);
            }
          }
          return $q.reject(rejection);
        }
      };
    }];

    $httpProvider.interceptors.push(interceptor);
  }]);

/**
 * Loading Bar
 *
 * This service handles adding and removing the actual element in the DOM.
 * Generally, best practices for DOM manipulation is to take place in a
 * directive, but because the element itself is injected in the DOM only upon
 * XHR requests, and it's likely needed on every view, the best option is to
 * use a service.
 */
angular.module('cfp.loadingBar', [])
  .provider('cfpLoadingBar', function() {

    this.includeSpinner = true;
    this.includeBar = true;
    this.latencyThreshold = 100;
    this.startSize = 0.02;
    this.parentSelector = 'body';
    this.spinnerTemplate = '<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>';
    this.loadingBarTemplate = '<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>';

    this.$get = ['$injector', '$document', '$timeout', '$rootScope', function ($injector, $document, $timeout, $rootScope) {
      var $animate;
      var $parentSelector = this.parentSelector,
        loadingBarContainer = angular.element(this.loadingBarTemplate),
        loadingBar = loadingBarContainer.find('div').eq(0),
        spinner = angular.element(this.spinnerTemplate);

      var incTimeout,
        completeTimeout,
        started = false,
        status = 0;

      var includeSpinner = this.includeSpinner;
      var includeBar = this.includeBar;
      var startSize = this.startSize;

      /**
       * Inserts the loading bar element into the dom, and sets it to 2%
       */
      function _start() {
        if (!$animate) {
          $animate = $injector.get('$animate');
        }

        var $parent = $document.find($parentSelector).eq(0);
        $timeout.cancel(completeTimeout);

        // do not continually broadcast the started event:
        if (started) {
          return;
        }

        $rootScope.$broadcast('cfpLoadingBar:started');
        started = true;

        if (includeBar) {
          $animate.enter(loadingBarContainer, $parent);
        }

        if (includeSpinner) {
          $animate.enter(spinner, $parent);
        }

        _set(startSize);
      }

      /**
       * Set the loading bar's width to a certain percent.
       *
       * @param n any value between 0 and 1
       */
      function _set(n) {
        if (!started) {
          return;
        }
        var pct = (n * 100) + '%';
        loadingBar.css('width', pct);
        status = n;

        // increment loadingbar to give the illusion that there is always
        // progress but make sure to cancel the previous timeouts so we don't
        // have multiple incs running at the same time.
        $timeout.cancel(incTimeout);
        incTimeout = $timeout(function() {
          _inc();
        }, 250);
      }

      /**
       * Increments the loading bar by a random amount
       * but slows down as it progresses
       */
      function _inc() {
        if (_status() >= 1) {
          return;
        }

        var rnd = 0;

        // TODO: do this mathmatically instead of through conditions

        var stat = _status();
        if (stat >= 0 && stat < 0.25) {
          // Start out between 3 - 6% increments
          rnd = (Math.random() * (5 - 3 + 1) + 3) / 100;
        } else if (stat >= 0.25 && stat < 0.65) {
          // increment between 0 - 3%
          rnd = (Math.random() * 3) / 100;
        } else if (stat >= 0.65 && stat < 0.9) {
          // increment between 0 - 2%
          rnd = (Math.random() * 2) / 100;
        } else if (stat >= 0.9 && stat < 0.99) {
          // finally, increment it .5 %
          rnd = 0.005;
        } else {
          // after 99%, don't increment:
          rnd = 0;
        }

        var pct = _status() + rnd;
        _set(pct);
      }

      function _status() {
        return status;
      }

      function _completeAnimation() {
        status = 0;
        started = false;
      }

      function _complete() {
        if (!$animate) {
          $animate = $injector.get('$animate');
        }

        $rootScope.$broadcast('cfpLoadingBar:completed');
        _set(1);

        $timeout.cancel(completeTimeout);

        // Attempt to aggregate any start/complete calls within 500ms:
        completeTimeout = $timeout(function() {
          var promise = $animate.leave(loadingBarContainer, _completeAnimation);
          if (promise && promise.then) {
            promise.then(_completeAnimation);
          }
          $animate.leave(spinner);
        }, 500);
      }

      return {
        start            : _start,
        set              : _set,
        status           : _status,
        inc              : _inc,
        complete         : _complete,
        includeSpinner   : this.includeSpinner,
        latencyThreshold : this.latencyThreshold,
        parentSelector   : this.parentSelector,
        startSize        : this.startSize
      };

    }];     //
  });       // wtf javascript. srsly
})();       //
    //@ sourceURL=pen.js
  </script>

</body>

</html>
