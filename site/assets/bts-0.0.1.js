/**
 * bts - v0.0.1 - 2014-10-27
 * http://behindthesite.com
 *
 * Copyright (c) 2014 bts <info@behindthesite.com>
 * Licensed All Rights Reserved <http://behindthesite.com/>
 */
!function(a,b,c){function d(a,b,c){var d=this;d.headers=[],d.products=[],d.getTaxonomyIds=function(a){var b=[];b.push(a.id);for(var c in a.children){var e=a.children[c];b=b.concat(d.getTaxonomyIds(e))}return b},d.findHeaderIndex=function(a){var b=a.category.id;for(var c in d.headers){var e=$.inArray(b,d.headers[c].ids);if(e>-1)return c}return-1},b.get(function(a){var b=a.taxonomy;console.log("Taxonomy: "+b.length);for(var c in b){var e=b[c],f={name:e.name};f.ids=d.getTaxonomyIds(e),d.headers.push(f)}}),c.get(function(a){var b=a.products;console.log("Products: "+b.length);for(var c in b){var e=b[c],f={name:e.name};f.company=e.company,f.tiers=[];for(var g in d.headers)f.tiers[g]=[],f.tiers[g].name=d.headers[g].name;var h=e.stack.tiers;for(var i in h){var j=d.findHeaderIndex(h[i]);f.tiers[j].push(h[i])}d.products.push(f)}})}var e=b.module("btsApp",["btsControllers","btsDirectives","btsFilters","btsServices","chieffancypants.loadingBar","ngAnimate"]);e.config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!0,a.includeBar=!0}]),e.config(["$httpProvider",function(a){a.interceptors.push(function(a,b){return{request:function(c){return console.log("Request"),b.$broadcast("loading-started"),c||a.when(c)},response:function(c){return console.log("Response"),b.$broadcast("loading-complete"),c||a.when(c)}}})}]);var f=b.module("btsServices",["ngResource"]);f.factory("TaxonomySvc",["$resource",function(a){return a("http://api.behindthesite.com/v1/taxonomy/")}]),f.factory("StackSvc",["$resource",function(a){return a("http://api.behindthesite.com/v1/stacks/")}]);var g=b.module("btsDirectives",[]);g.directive("loadingIndicator",function(){return console.log("loadingIndicator"),{restrict:"A",template:"<div>Loading...</div>",link:function(a,b){a.$on("loading-started",function(){b.css({display:""})}),a.$on("loading-complete",function(){b.css({display:"none"})})}}}),g.directive("affix",["$templateCache",function(){return console.log("affix"),function(a,c){var d=b.element(c);a.affix_widths=[],d.affix({offset:{top:function(){return $("#main").offset().top}}}),d.on("affix.bs.affix",function(){console.log("affix.prior");var b=d.find("th");b.each(function(b){a.affix_widths[b]=$(this).width()})}),d.on("affixed.bs.affix",function(){console.log("affix.post");var b=d.find("th");b.each(function(b){$(this).width(a.affix_widths[b])})})}}]),g.directive("itemDisplayed",["$templateCache","$compile",function(a,c){return console.log("itemDisplayed"),function(d,e,f){var g=b.element(e),h=g.find("span"),i=a.get("productHoverTmpl.html");d.website=f.website,d.twitter=f.twitter,d.irc=f.irc,d.blogs=f.blogs,d.description=f.description,d.repo=f.repo,d.issues=f.issues,d.docs=f.docs,d.category=f.category,d.categorypath=f.categorypath,d.notes=f.notes;var j=c(a.get("productHoverContentTmpl.html"))(d),k={html:!0,title:f.title,content:j,placement:"top",template:i,trigger:"manual"};h.data("state","hover"),h.popover(k),h.on("mouseenter",function(){"hover"===h.data("state")&&h.popover("show")}),h.on("mouseleave",function(){"hover"===h.data("state")&&h.popover("hide")}),h.on("click",function(){"hover"===h.data("state")?h.data("state","pinned"):(h.data("state","hover"),h.popover("hide"))}),g.on("shown.bs.popover",function(){g.find(".close-btn").click(function(){h.data("state","hover"),h.popover("hide")})})}}]);var h=b.module("btsFilters",[]);h.filter("ws",function(){return function(a){return a?a.toLowerCase().replace(/[^a-z_]/g,"_"):void 0}}),h.filter("nocraigslist",function(){return function(a){var b=[];if(a)for(var c in a)"Craigslist Website"!=a[c].name&&b.push(a[c]);return b}});var i=b.module("btsControllers",[]);i.controller("TableCtrl",d),function(){"use strict";b.module("angular-loading-bar",["cfp.loadingBarInterceptor"]),b.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]),b.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(a){var d=["$q","$cacheFactory","$timeout","$rootScope","cfpLoadingBar",function(d,e,f,g,h){function i(){f.cancel(k),h.complete(),m=0,l=0}function j(d){var f,g=e.get("$http"),h=a.defaults;!d.cache&&!h.cache||d.cache===!1||"GET"!==d.method&&"JSONP"!==d.method||(f=b.isObject(d.cache)?d.cache:b.isObject(h.cache)?h.cache:g);var i=f!==c?f.get(d.url)!==c:!1;return d.cached!==c&&i!==d.cached?d.cached:(d.cached=i,i)}var k,l=0,m=0,n=h.latencyThreshold;return{request:function(a){return a.ignoreLoadingBar||j(a)||(g.$broadcast("cfpLoadingBar:loading",{url:a.url}),0===l&&(k=f(function(){h.start()},n)),l++,h.set(m/l)),a},response:function(a){return a.config.ignoreLoadingBar||j(a.config)||(m++,g.$broadcast("cfpLoadingBar:loaded",{url:a.config.url,result:a}),m>=l?i():h.set(m/l)),a},responseError:function(a){return a.config.ignoreLoadingBar||j(a.config)||(m++,g.$broadcast("cfpLoadingBar:loaded",{url:a.config.url,result:a}),m>=l?i():h.set(m/l)),d.reject(a)}}}];a.interceptors.push(d)}]),b.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.includeSpinner=!0,this.includeBar=!0,this.latencyThreshold=100,this.startSize=.02,this.parentSelector="body",this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>',this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>',this.$get=["$injector","$document","$timeout","$rootScope",function(a,c,d,e){function f(){l||(l=a.get("$animate"));var b=c.find(o).eq(0);d.cancel(n),s||(e.$broadcast("cfpLoadingBar:started"),s=!0,v&&l.enter(p,b),u&&l.enter(r,b),g(w))}function g(a){if(s){var b=100*a+"%";q.css("width",b),t=a,d.cancel(m),m=d(function(){h()},250)}}function h(){if(!(i()>=1)){var a=0,b=i();a=b>=0&&.25>b?(3*Math.random()+3)/100:b>=.25&&.65>b?3*Math.random()/100:b>=.65&&.9>b?2*Math.random()/100:b>=.9&&.99>b?.005:0;var c=i()+a;g(c)}}function i(){return t}function j(){t=0,s=!1}function k(){l||(l=a.get("$animate")),e.$broadcast("cfpLoadingBar:completed"),g(1),d.cancel(n),n=d(function(){var a=l.leave(p,j);a&&a.then&&a.then(j),l.leave(r)},500)}var l,m,n,o=this.parentSelector,p=b.element(this.loadingBarTemplate),q=p.find("div").eq(0),r=b.element(this.spinnerTemplate),s=!1,t=0,u=this.includeSpinner,v=this.includeBar,w=this.startSize;return{start:f,set:g,status:i,inc:h,complete:k,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})}(),b.module("plusOne",[]).directive("plusOne",function(){return{link:function(a,b){gapi.plusone.render(b[0],{size:"medium",href:"http://bit.ly/ngBoilerplate"})}}}),b.module("templates-app",[]),b.module("templates-common",[])}(window,window.angular);